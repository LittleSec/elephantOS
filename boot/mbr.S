;主引导程序 
;------------------------------------------------------
; 在屏幕上打印字符串 "1 MBR", 背景色为闪烁绿色，前景色为红色
;------------------------------------------------------

SECTION MBR vstart=0x7c00         
    mov ax, cs      
    mov ds, ax
    mov es, ax
    mov ss, ax
    mov fs, ax
    mov sp, 0x7c00
; 地址总线中的 0xb8000 ~ 0xbffff 这 32Kb 的内存区域用于文本显示
    mov ax, 0xb800
    mov gs, ax

;------------------------------------------------------
;INT 0x10
;BIOS 的 Video Service, 提供了屏幕及显示器所提供的服务程序
;该程序提供多种显示功能，功能号置于AH寄存器，下面列举本代码用到的
;0x06: 初始化和上卷窗口
;具体参数和返回值见下方
;------------------------------------------------------

;清屏，利用0x06号功能，上卷全部行，则可清屏。
;------------------------------------------------------
;INT 0x10   功能号:0x06	   功能描述: 上卷窗口
;------------------------------------------------------
;输入：
;   AH = 功能号 0x06
;   AL = 上卷的行数(如果为0,表示全部)
;   BH = 上卷行属性
;   (CL,CH) = 窗口左上角的(X,Y)位置
;   (DL,DH) = 窗口右下角的(X,Y)位置
;输出：
;   无
    mov ax, 0x600   ; 或者 mov al, 0x0
                    ; mov ah, 0x6
    mov bx, 0x700
    mov cx, 0       ; 左上角: (0, 0)
    mov dx, 0x184f  ; 右下角: (80,25),
                    ; VGA 文本模式中,一行只能容纳 80 个字符, 共 25 行。
                    ; 下标从 0 开始,所以0x18=24,0x4f=79
    int 0x10        ; int 0x10

;打印字符串
;bit 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 1
;   |K  R  G  B | I  R G B |    ASCII     |
;   |   背景色   |   前景色  |
; 是否闪烁       高亮位
;   |1  0  1  0 | 0  1 0 0 | <==> (0xA4)
    mov byte [gs:0x00], '1'
    mov byte [gs:0x01], 0xA4    ; A表示绿色背景闪烁，4表示前景色为红色

    mov byte [gs:0x02], ' '
    mov byte [gs:0x03], 0xA4

    mov byte [gs:0x04], 'M'
    mov byte [gs:0x05], 0xA4

    mov byte [gs:0x06], 'B'
    mov byte [gs:0x07], 0xA4

    mov byte [gs:0x08], 'R'
    mov byte [gs:0x09], 0xA4


    jmp $		    ; dead loop


; 填充扇区剩余空间，并设置魔数
    times 510-($-$$) db 0
    db 0x55,0xaa
